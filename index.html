<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<title>Wejuman – Coscienza globale</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link
rel="stylesheet"
href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
html, body {
margin: 0;
padding: 0;
height: 100%;
background: #0e0f12;
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
color: #eaeaea;
}

#map {
height: 100%;
width: 100%;
}

/* Top bar */
#topbar {
position: fixed;
top: 10px;
left: 10px;
right: 10px;
z-index: 1000;
display: flex;
gap: 8px;
align-items: center;
background: rgba(30,30,34,0.75);
backdrop-filter: blur(14px);
border-radius: 14px;
padding: 10px 12px;
}

#menuBtn, #resetBtn {
background: rgba(255,255,255,0.08);
border: none;
color: #fff;
padding: 8px 12px;
border-radius: 10px;
font-size: 14px;
}

#title {
flex: 1;
font-weight: 600;
}

/* Bottom bar */
#bottombar {
position: fixed;
bottom: 10px;
left: 10px;
right: 10px;
z-index: 1000;
background: rgba(30,30,34,0.8);
backdrop-filter: blur(14px);
border-radius: 14px;
padding: 12px;
font-size: 14px;
line-height: 1.4;
}

/* Categories panel */
#panel {
position: fixed;
inset: 0;
z-index: 2000;
background: rgba(0,0,0,0.55);
display: none;
}

#panelContent {
background: rgba(30,30,34,0.95);
margin: 60px auto;
width: calc(100% - 40px);
max-width: 420px;
border-radius: 16px;
padding: 16px;
}

.category {
display: inline-block;
margin: 6px;
padding: 8px 12px;
background: rgba(255,255,255,0.08);
border-radius: 20px;
cursor: pointer;
font-size: 14px;
}

.category.active {
background: #4dd0e1;
color: #000;
}

.small {
opacity: 0.6;
font-size: 13px;
margin-top: 10px;
}
</style>
</head>

<body>

<div id="topbar">
<button id="menuBtn">☰</button>
<div id="title">Wejuman · Coscienza globale</div>
<button id="resetBtn">Reset</button>
</div>

<div id="bottombar">
Qui intorno<br>
<span id="nearText">Caricamento…</span>
</div>

<div id="panel">
<div id="panelContent">
<h3>Categorie</h3>
<p class="small">
Il filtro non giudica: evidenzia ciò che cerchi, senza cancellare il resto.
</p>

<div id="categories"></div>

<label class="small">
<input type="checkbox" id="onlyHighlighted">
Mostra solo evidenziati
</label>

<p class="small" id="stats"></p>

<button id="closePanel" style="margin-top:10px">Chiudi</button>
</div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const categoriesList = [
"Ambiente",
"Cibo",
"Acqua",
"Salute",
"Educazione",
"Bambini",
"Donne",
"Diritti umani",
"Emergenze",
"Comunità",
"Rifugiati",
"Generale"
];

let activeCategories = new Set(categoriesList);

const map = L.map('map', {
zoomControl: false
}).setView([20,0], 2);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '© OpenStreetMap contributors'
}).addTo(map);

let markers = [];

fetch('points.json')
.then(r => r.json())
.then(points => {
points.forEach(p => {
const m = L.circleMarker([p.lat, p.lon], {
radius: 6,
color: '#ffffff',
fillOpacity: 0.8
}).addTo(map);

m.category = p.category || "Generale";
m.data = p;
markers.push(m);
});
updateNear();
updateStats();
});

function updateNear() {
document.getElementById("nearText").innerText =
markers.slice(0,3).map(m => m.data.name).join(" · ");
}

function updateStats() {
document.getElementById("stats").innerText =
`Punti caricati: ${markers.length} · Evidenziati: ${markers.filter(m => activeCategories.has(m.category)).length}`;
}

/* Menu */
const panel = document.getElementById("panel");
document.getElementById("menuBtn").onclick = () => panel.style.display = "block";
document.getElementById("closePanel").onclick = () => panel.style.display = "none";

const catBox = document.getElementById("categories");
categoriesList.forEach(c => {
const el = document.createElement("div");
el.className = "category active";
el.innerText = c;
el.onclick = () => {
if (activeCategories.has(c)) {
activeCategories.delete(c);
el.classList.remove("active");
} else {
activeCategories.add(c);
el.classList.add("active");
}
markers.forEach(m => {
m.setStyle({
opacity: activeCategories.has(m.category) ? 1 : 0.2
});
});
updateStats();
};
catBox.appendChild(el);
});

document.getElementById("resetBtn").onclick = () => location.reload();
</script>

</body>
</html>
